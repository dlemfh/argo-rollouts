apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

configurations:
- ../../../docs/features/kustomize/rollout-transform-2023-10-09.yaml

namePrefix: my-

resources:
- rollout.yaml

configMapGenerator:
- name: guestbook-cm
  literals:
  - FOO=BAR

secretGenerator:
- name: guestbook-secret
  literals:
  - password=Pa55w0rd

labels:
- includeSelectors: true
  includeTemplates: true
  pairs:
    foo: bar
- includeSelectors: false
  includeTemplates: true
  pairs:
    baz: qux

commonAnnotations:
  foo: bar

vars:
- name: SERVICE_NAME
  objref:
    kind: Service
    name: guestbook-stable-svc
    apiVersion: v1
  fieldref:
    fieldpath: metadata.name

replicas:
- name: guestbook
  count: 3

images:
- name: guestbook
  newTag: v2

openapi:
  path: https://raw.githubusercontent.com/argoproj/argo-schema-generator/main/schema/argo_all_k8s_kustomize_schema.json

patches:
- patch: |-
    apiVersion: argoproj.io/v1alpha1
    kind: Rollout
    metadata:
      name: guestbook
    spec:
      template:
        spec:
          containers:
          - name: guestbook
            image: guestbook-patched:v1
